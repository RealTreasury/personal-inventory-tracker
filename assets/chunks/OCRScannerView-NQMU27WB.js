/*! Personal Inventory Tracker Enhanced */
import{B as _,C as p,D as z,b as J,c as K,d as j,g as O,h as P,s as T,u as L,x as M}from"./chunk-LT2OG7SB.js";var e=J(K());var f;function U(){return f||(f=import("./tesseract.esm.min.js").catch(c=>{throw console.error("Tesseract failed to load.",c),new Error("Failed to load OCR engine. Please check plugin installation.")})),f}var Z=({onItemsExtracted:c,items:q=[]})=>{let[A,v]=(0,e.useState)(!1),[m,g]=(0,e.useState)([]),[x,E]=(0,e.useState)(null),[u,F]=(0,e.useState)(60),[$,o]=(0,e.useState)(""),[r,h]=(0,e.useState)({language:"eng",psm:"6",oem:"1",whitelist:"",blacklist:""}),y=(0,e.useRef)(null),l=(0,e.useRef)(null),w=(0,e.useRef)(null),B=async()=>{try{let t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}});l.current&&(l.current.srcObject=t)}catch(t){console.error("Camera access failed:",t),alert("Camera access failed. Please use file upload instead.")}},N=()=>{var t;(t=l.current)!=null&&t.srcObject&&(l.current.srcObject.getTracks().forEach(i=>i.stop()),l.current.srcObject=null)},W=()=>{let t=w.current,s=l.current;if(t&&s){let n=t.getContext("2d");t.width=s.videoWidth,t.height=s.videoHeight,n.drawImage(s,0,0),t.toBlob(i=>{C(i),N()},"image/jpeg",.9)}},D=t=>{let s=t.target.files[0];if(s&&s.type.startsWith("image/")){let n=new FileReader;n.onload=i=>E(i.target.result),n.readAsDataURL(s),C(s)}},C=async t=>{v(!0),g([]),o("Initializing...");try{let s=await U();o("Loading OCR engine...");let n=await s.createWorker({logger:({status:a,progress:b})=>{o(a==="recognizing text"?`Recognizing text... ${Math.round(b*100)}%`:a)}});o("Configuring OCR settings..."),await n.loadLanguage(r.language),await n.initialize(r.language),await n.setParameters({tessedit_pageseg_mode:r.psm,tessedit_ocr_engine_mode:r.oem,tessedit_char_whitelist:r.whitelist,tessedit_char_blacklist:r.blacklist}),o("Scanning image...");let d=(await n.recognize(t)).data.lines.filter(a=>a.confidence>=u).map(a=>({text:a.text.trim(),confidence:Math.round(a.confidence),bbox:a.bbox,words:a.words})).filter(a=>a.text.length>2);g(d),o(""),await n.terminate(),c&&c(d)}catch(s){console.error("OCR processing failed:",s),o(""),alert("OCR processing failed. Please try again.")}finally{v(!1)}},V=t=>{let s=t.toLowerCase().trim();return q.find(n=>n.title.toLowerCase().includes(s)||s.includes(n.title.toLowerCase()))},S=async(t,s=1)=>{var n,i;try{(await fetch(`${(n=window.pitApp)==null?void 0:n.restUrl}items`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":(i=window.pitApp)==null?void 0:i.nonce},body:JSON.stringify({title:t.text,qty:s,purchased:!0})})).ok&&g(a=>a.filter(b=>b!==t))}catch(d){console.error("Failed to add item:",d)}},X=({isOpen:t,onClose:s})=>t?e.default.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},e.default.createElement("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4"},e.default.createElement("div",{className:"flex justify-between items-center mb-6"},e.default.createElement("h3",{className:"text-lg font-semibold"},"OCR Settings"),e.default.createElement("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded"},e.default.createElement(p,{className:"h-5 w-5"}))),e.default.createElement("div",{className:"space-y-4"},e.default.createElement("div",null,e.default.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"Confidence Threshold: ",u,"%"),e.default.createElement("input",{type:"range",min:"30",max:"95",value:u,onChange:n=>F(parseInt(n.target.value)),className:"w-full"}),e.default.createElement("div",{className:"flex justify-between text-xs text-gray-500 mt-1"},e.default.createElement("span",null,"Less Strict"),e.default.createElement("span",null,"More Strict"))),e.default.createElement("div",null,e.default.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"Language"),e.default.createElement("select",{value:r.language,onChange:n=>h(i=>({...i,language:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md"},e.default.createElement("option",{value:"eng"},"English"),e.default.createElement("option",{value:"spa"},"Spanish"),e.default.createElement("option",{value:"fra"},"French"),e.default.createElement("option",{value:"deu"},"German"),e.default.createElement("option",{value:"ita"},"Italian"))),e.default.createElement("div",null,e.default.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"Page Segmentation Mode"),e.default.createElement("select",{value:r.psm,onChange:n=>h(i=>({...i,psm:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md"},e.default.createElement("option",{value:"3"},"Fully automatic"),e.default.createElement("option",{value:"6"},"Single block (default)"),e.default.createElement("option",{value:"7"},"Single text line"),e.default.createElement("option",{value:"8"},"Single word"),e.default.createElement("option",{value:"11"},"Sparse text"),e.default.createElement("option",{value:"13"},"Raw line")))),e.default.createElement("div",{className:"flex justify-end space-x-3 mt-6"},e.default.createElement("button",{onClick:s,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50"},"Cancel"),e.default.createElement("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},"Save Settings")))):null,[G,k]=(0,e.useState)(!1),[H,I]=(0,e.useState)(!1);return e.default.createElement("div",{className:"space-y-6"},e.default.createElement("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},e.default.createElement("div",{className:"flex justify-between items-center"},e.default.createElement("div",null,e.default.createElement("h2",{className:"text-xl font-semibold text-gray-900"},"Receipt Scanner"),e.default.createElement("p",{className:"text-gray-600 mt-1"},"Scan receipts to automatically add items to your inventory")),e.default.createElement("button",{onClick:()=>k(!0),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg"},e.default.createElement(M,{className:"h-5 w-5"})))),e.default.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6"},e.default.createElement("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},e.default.createElement("div",{className:"text-center"},e.default.createElement(j,{className:"h-12 w-12 text-blue-500 mx-auto mb-4"}),e.default.createElement("h3",{className:"font-semibold text-gray-900 mb-2"},"Take Photo"),e.default.createElement("p",{className:"text-gray-600 text-sm mb-4"},"Use your camera to capture receipts directly"),e.default.createElement("button",{onClick:()=>{I(!0),B()},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},"Open Camera"))),e.default.createElement("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},e.default.createElement("div",{className:"text-center"},e.default.createElement(_,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),e.default.createElement("h3",{className:"font-semibold text-gray-900 mb-2"},"Upload Image"),e.default.createElement("p",{className:"text-gray-600 text-sm mb-4"},"Select an image file from your device"),e.default.createElement("input",{ref:y,type:"file",accept:"image/*",onChange:D,className:"hidden"}),e.default.createElement("button",{onClick:()=>{var t;return(t=y.current)==null?void 0:t.click()},className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"},"Choose File")))),H&&e.default.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50"},e.default.createElement("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full mx-4"},e.default.createElement("div",{className:"flex justify-between items-center mb-4"},e.default.createElement("h3",{className:"text-lg font-semibold"},"Camera"),e.default.createElement("button",{onClick:()=>{I(!1),N()},className:"p-1 hover:bg-gray-100 rounded"},e.default.createElement(p,{className:"h-5 w-5"}))),e.default.createElement("div",{className:"relative"},e.default.createElement("video",{ref:l,autoPlay:!0,playsInline:!0,className:"w-full rounded-lg"}),e.default.createElement("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2"},e.default.createElement("button",{onClick:W,className:"w-16 h-16 bg-white rounded-full shadow-lg hover:shadow-xl transition-shadow flex items-center justify-center"},e.default.createElement("div",{className:"w-12 h-12 bg-blue-600 rounded-full"})))))),x&&e.default.createElement("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},e.default.createElement("h3",{className:"font-semibold text-gray-900 mb-4"},"Image Preview"),e.default.createElement("div",{className:"flex justify-center"},e.default.createElement("img",{src:x,alt:"Receipt preview",className:"max-w-full max-h-96 object-contain rounded-lg border border-gray-300"}))),A&&e.default.createElement("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},e.default.createElement("div",{className:"flex items-center justify-center space-x-3"},e.default.createElement(T,{className:"h-6 w-6 animate-spin text-blue-600"}),e.default.createElement("div",null,e.default.createElement("p",{className:"font-medium text-gray-900"},"Processing Image..."),e.default.createElement("p",{className:"text-sm text-gray-600"},$))),e.default.createElement("div",{className:"mt-4 bg-gray-200 rounded-full h-2"},e.default.createElement("div",{className:"bg-blue-600 h-2 rounded-full animate-pulse",style:{width:"60%"}}))),m.length>0&&e.default.createElement("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},e.default.createElement("div",{className:"flex justify-between items-center mb-6"},e.default.createElement("h3",{className:"font-semibold text-gray-900"},"Scanned Items (",m.length,")"),e.default.createElement("div",{className:"flex items-center space-x-2 text-sm text-gray-600"},e.default.createElement(z,{className:"h-4 w-4"}),e.default.createElement("span",null,"Min confidence: ",u,"%"))),e.default.createElement("div",{className:"space-y-3"},m.map((t,s)=>{let n=V(t.text);return e.default.createElement("div",{key:s,className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:border-gray-300 transition-colors"},e.default.createElement("div",{className:"flex-1"},e.default.createElement("div",{className:"flex items-center space-x-3"},e.default.createElement("div",{className:"flex-1"},e.default.createElement("p",{className:"font-medium text-gray-900"},t.text),e.default.createElement("div",{className:"flex items-center space-x-4 mt-1"},e.default.createElement("span",{className:`text-xs px-2 py-1 rounded-full ${t.confidence>=80?"bg-green-100 text-green-700":t.confidence>=60?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`},t.confidence,"% confident"),n&&e.default.createElement("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full"},"Matches: ",n.title))))),e.default.createElement("div",{className:"flex items-center space-x-2 ml-4"},e.default.createElement("input",{type:"number",defaultValue:"1",min:"1",className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded",id:`qty-${s}`}),e.default.createElement("button",{onClick:()=>{let i=document.getElementById(`qty-${s}`).value;S(t,parseInt(i)||1)},className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors flex items-center space-x-1"},e.default.createElement(L,{className:"h-3 w-3"}),e.default.createElement("span",null,"Add")),e.default.createElement("button",{onClick:()=>g(i=>i.filter((d,a)=>a!==s)),className:"p-1 text-gray-400 hover:text-red-500 transition-colors"},e.default.createElement(p,{className:"h-4 w-4"}))))})),m.length>0&&e.default.createElement("div",{className:"flex justify-center mt-6"},e.default.createElement("button",{onClick:()=>{m.forEach((t,s)=>{let n=document.getElementById(`qty-${s}`),i=n&&parseInt(n.value)||1;S(t,i)})},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2"},e.default.createElement(O,{className:"h-4 w-4"}),e.default.createElement("span",null,"Add All Items")))),e.default.createElement("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6"},e.default.createElement("div",{className:"flex items-start space-x-3"},e.default.createElement(P,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.default.createElement("div",null,e.default.createElement("h4",{className:"font-medium text-blue-900"},"OCR Tips for Best Results"),e.default.createElement("ul",{className:"text-sm text-blue-800 mt-2 space-y-1"},e.default.createElement("li",null,"\u2022 Ensure good lighting and avoid shadows"),e.default.createElement("li",null,"\u2022 Keep the camera steady and receipt flat"),e.default.createElement("li",null,"\u2022 Make sure text is clearly visible and in focus"),e.default.createElement("li",null,"\u2022 Crop images to show only the receipt area"),e.default.createElement("li",null,"\u2022 Use high resolution images when possible"))))),e.default.createElement("canvas",{ref:w,style:{display:"none"}}),e.default.createElement(X,{isOpen:G,onClose:()=>k(!1)}))},ee=Z;export{ee as default};
