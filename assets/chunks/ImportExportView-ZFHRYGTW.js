/*! Personal Inventory Tracker Enhanced */
import{B as T,C as Q,b as de,c as ce,h as H,i as W,j as L,l as U,m as D,n as G,q as K,v as A}from"./chunk-LT2OG7SB.js";var e=de(ce());function Y(v,b){return new Promise((m,o)=>{let u=new FileReader;u.onload=a=>{try{let w=a.target.result.replace(/^\uFEFF/,"").split(`
`).map(n=>n.trim()).filter(n=>n),d=w[0].split(",").map(n=>n.replace(/["']/g,"").trim()),c=w.slice(1).map(n=>{let k=n.split(",").map(p=>p.replace(/["']/g,"").trim()),N={};return d.forEach((p,i)=>{N[p]=k[i]||""}),N}),g={};d.forEach(n=>{let k=n.toLowerCase();Object.entries(b.csv).forEach(([N,p])=>{p.some(i=>k.includes(i))&&(g[N]=n)})}),m({data:c,mapping:g})}catch(f){o(new Error("Failed to parse CSV file"))}},u.onerror=()=>o(new Error("Failed to read file")),u.readAsText(v)})}function Z(v){return new Promise((b,m)=>{let o=new FileReader;o.onload=u=>{try{let a=JSON.parse(u.target.result);if(!Array.isArray(a)){m(new Error("JSON must contain an array of items"));return}let f={};if(a.length>0){let w=a[0];Object.keys(w).forEach(d=>{let c=d.toLowerCase();c.includes("name")||c.includes("title")?f.title=d:c.includes("qty")||c.includes("quantity")?f.qty=d:c.includes("category")&&(f.category=d)})}b({data:a,mapping:f})}catch(a){m(new Error("Failed to parse JSON file"))}},o.onerror=()=>m(new Error("Failed to read file")),o.readAsText(v)})}function R(){return Promise.reject(new Error("Excel import coming soon! Please use CSV for now."))}function J(v,b,m){let o=new Blob([v],{type:m}),u=URL.createObjectURL(o),a=document.createElement("a");a.href=u,a.download=b,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(u)}var pe=({onItemsUpdated:v})=>{let[b,m]=(0,e.useState)("import"),[o,u]=(0,e.useState)("csv"),[a,f]=(0,e.useState)("csv"),[w,d]=(0,e.useState)(!1),[c,g]=(0,e.useState)(!1),[n,k]=(0,e.useState)(!1),[N,p]=(0,e.useState)(0),[i,$]=(0,e.useState)(null),[E,M]=(0,e.useState)([]),[ee,F]=(0,e.useState)(!1),[V,q]=(0,e.useState)({}),[C,j]=(0,e.useState)({updateExisting:!0,createNew:!0,skipErrors:!0,validateData:!0}),_=(0,e.useRef)(null),X=(0,e.useRef)(null),O={import:{csv:{label:"CSV File",icon:D,accept:".csv",description:"Comma-separated values"},json:{label:"JSON File",icon:U,accept:".json",description:"JavaScript Object Notation"},excel:{label:"Excel File",icon:D,accept:".xlsx,.xls",description:"Microsoft Excel"},api:{label:"API Import",icon:K,accept:"",description:"Import from external API"}},export:{csv:{label:"CSV File",icon:D,description:"Comma-separated values"},json:{label:"JSON File",icon:U,description:"JavaScript Object Notation"},excel:{label:"Excel File",icon:D,description:"Microsoft Excel (coming soon)"},pdf:{label:"PDF Report",icon:G,description:"Printable inventory report"}}},re={csv:{title:["title","name","item_name","product_name"],qty:["qty","quantity","stock","amount"],category:["category","type","group"],unit:["unit","measure","measurement"],threshold:["threshold","min_stock","reorder_level"],notes:["notes","description","memo"]}},se=r=>{let s=r.target.files[0];s&&z(s)},te=(0,e.useCallback)(r=>{r.preventDefault(),d(!1);let s=Array.from(r.dataTransfer.files);s.length>0&&z(s[0])},[]),ae=(0,e.useCallback)(r=>{r.preventDefault(),d(!0)},[]),oe=(0,e.useCallback)(r=>{r.preventDefault(),d(!1)},[]),z=async r=>{g(!0),p(10);try{let s;o==="csv"?s=await Y(r,re):o==="json"?s=await Z(r):o==="excel"&&(s=await R(r)),p(50),s&&(q(s.mapping||{}),M(s.data.slice(0,10)),F(!0)),p(100)}catch(s){console.error("File processing error:",s),$({success:!1,error:s.message,imported:0,skipped:0,errors:[]})}finally{g(!1)}},ie=async()=>{var r,s;g(!0),p(0);try{let t=E.map(x=>{let P={};return Object.entries(V).forEach(([y,S])=>{S&&x[S]!==void 0&&(P[y]=x[S])}),P}),l=10,I=0,h=0,B=[];for(let x=0;x<t.length;x+=l){let P=t.slice(x,x+l);try{let y=await fetch(`${(r=window.pitApp)==null?void 0:r.restUrl}items/import`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":(s=window.pitApp)==null?void 0:s.nonce},body:JSON.stringify({items:P,settings:C})});if(y.ok){let S=await y.json();I+=S.imported||0,h+=S.skipped||0}else throw new Error(`HTTP ${y.status}`)}catch(y){if(B.push(`Batch ${Math.floor(x/l)+1}: ${y.message}`),!C.skipErrors)throw y}p(Math.round((x+l)/t.length*100))}$({success:!0,imported:I,skipped:h,errors:B,total:t.length}),v&&v()}catch(t){$({success:!1,error:t.message,imported:0,skipped:0,errors:[]})}finally{g(!1),F(!1)}},le=async()=>{var r,s;k(!0);try{let t=await fetch(`${(r=window.pitApp)==null?void 0:r.restUrl}export?format=${a}`,{headers:{"X-WP-Nonce":(s=window.pitApp)==null?void 0:s.nonce}});if(!t.ok)throw new Error(`Export failed: ${t.status}`);if(a==="json"){let l=await t.json();J(JSON.stringify(l,null,2),`inventory-${new Date().toISOString().split("T")[0]}.json`,"application/json")}else if(a==="csv"){let l=await t.text();J(l,`inventory-${new Date().toISOString().split("T")[0]}.csv`,"text/csv")}else if(a==="pdf"){let l=await t.blob(),I=URL.createObjectURL(l),h=document.createElement("a");h.href=I,h.download=`inventory-report-${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(I)}}catch(t){console.error("Export error:",t),alert("Export failed: "+t.message)}finally{k(!1)}},ne=async()=>{var s;let r=(s=X.current)==null?void 0:s.value;if(!r){alert("Please enter an API URL");return}g(!0);try{let l=await(await fetch(r)).json();if(Array.isArray(l))M(l.slice(0,10)),F(!0);else throw new Error("API must return an array of items")}catch(t){alert("Failed to import from API: "+t.message)}finally{g(!1)}};return e.default.createElement("div",{className:"space-y-6"},e.default.createElement("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},e.default.createElement("h2",{className:"text-xl font-semibold text-gray-900 mb-2"},"Import & Export"),e.default.createElement("p",{className:"text-gray-600"},"Manage your inventory data with bulk import and export operations")),e.default.createElement("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},e.default.createElement("div",{className:"flex border-b border-gray-200"},e.default.createElement("button",{onClick:()=>m("import"),className:`flex-1 px-6 py-4 text-sm font-medium ${b==="import"?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`},e.default.createElement(T,{className:"h-4 w-4 inline mr-2"}),"Import Data"),e.default.createElement("button",{onClick:()=>m("export"),className:`flex-1 px-6 py-4 text-sm font-medium ${b==="export"?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`},e.default.createElement(L,{className:"h-4 w-4 inline mr-2"}),"Export Data")),e.default.createElement("div",{className:"p-6"},b==="import"?e.default.createElement("div",{className:"space-y-6"},e.default.createElement("div",null,e.default.createElement("h3",{className:"font-semibold text-gray-900 mb-3"},"Select Import Format"),e.default.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Object.entries(O.import).map(([r,s])=>e.default.createElement("div",{key:r,onClick:()=>u(r),className:`p-4 border-2 rounded-lg cursor-pointer transition-all ${o===r?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`},e.default.createElement("div",{className:"flex items-center space-x-3"},e.default.createElement(s.icon,{className:`h-6 w-6 ${o===r?"text-blue-600":"text-gray-400"}`}),e.default.createElement("div",null,e.default.createElement("div",{className:"font-medium text-gray-900"},s.label),e.default.createElement("div",{className:"text-sm text-gray-500"},s.description))))))),o==="api"?e.default.createElement("div",{className:"space-y-4"},e.default.createElement("div",null,e.default.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"API Endpoint URL"),e.default.createElement("div",{className:"flex space-x-3"},e.default.createElement("input",{ref:X,type:"url",placeholder:"https://api.example.com/inventory",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.default.createElement("button",{onClick:ne,disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors"},c?e.default.createElement(A,{className:"h-4 w-4 animate-spin"}):"Import")))):e.default.createElement("div",{onDrop:te,onDragOver:ae,onDragLeave:oe,className:`border-2 border-dashed rounded-xl p-8 text-center transition-colors ${w?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"}`},e.default.createElement(T,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.default.createElement("h3",{className:"text-lg font-medium text-gray-900 mb-2"},"Drop your ",O.import[o].label," here"),e.default.createElement("p",{className:"text-gray-500 mb-4"},"Or click to browse files"),e.default.createElement("input",{ref:_,type:"file",accept:O.import[o].accept,onChange:se,className:"hidden"}),e.default.createElement("button",{onClick:()=>{var r;return(r=_.current)==null?void 0:r.click()},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},"Choose File")),e.default.createElement("div",{className:"bg-gray-50 p-4 rounded-lg"},e.default.createElement("h4",{className:"font-medium text-gray-900 mb-3"},"Import Settings"),e.default.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",checked:C.updateExisting,onChange:r=>j(s=>({...s,updateExisting:r.target.checked})),className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Update existing items")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",checked:C.createNew,onChange:r=>j(s=>({...s,createNew:r.target.checked})),className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Create new items")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",checked:C.skipErrors,onChange:r=>j(s=>({...s,skipErrors:r.target.checked})),className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Skip errors and continue")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",checked:C.validateData,onChange:r=>j(s=>({...s,validateData:r.target.checked})),className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Validate data before import")))),c&&e.default.createElement("div",{className:"bg-blue-50 p-4 rounded-lg"},e.default.createElement("div",{className:"flex items-center space-x-3 mb-2"},e.default.createElement(A,{className:"h-5 w-5 text-blue-600 animate-spin"}),e.default.createElement("span",{className:"text-blue-800 font-medium"},"Processing import... ",N,"%")),e.default.createElement("div",{className:"w-full bg-blue-200 rounded-full h-2"},e.default.createElement("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${N}%`}}))),i&&e.default.createElement("div",{className:`p-4 rounded-lg ${i.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`},e.default.createElement("div",{className:"flex items-center space-x-3 mb-2"},i.success?e.default.createElement(W,{className:"h-5 w-5 text-green-600"}):e.default.createElement(H,{className:"h-5 w-5 text-red-600"}),e.default.createElement("span",{className:`font-medium ${i.success?"text-green-800":"text-red-800"}`},i.success?"Import Completed":"Import Failed")),i.success?e.default.createElement("div",{className:"text-sm text-green-700"},e.default.createElement("p",null,"Successfully imported ",i.imported," items"),i.skipped>0&&e.default.createElement("p",null,"Skipped ",i.skipped," items"),i.errors.length>0&&e.default.createElement("details",{className:"mt-2"},e.default.createElement("summary",{className:"cursor-pointer"},"View errors (",i.errors.length,")"),e.default.createElement("ul",{className:"mt-1 ml-4 list-disc"},i.errors.map((r,s)=>e.default.createElement("li",{key:s},r))))):e.default.createElement("div",{className:"text-sm text-red-700"},i.error))):e.default.createElement("div",{className:"space-y-6"},e.default.createElement("div",null,e.default.createElement("h3",{className:"font-semibold text-gray-900 mb-3"},"Select Export Format"),e.default.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Object.entries(O.export).map(([r,s])=>e.default.createElement("div",{key:r,onClick:()=>f(r),className:`p-4 border-2 rounded-lg cursor-pointer transition-all ${a===r?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"} ${r==="excel"?"opacity-50 cursor-not-allowed":""}`},e.default.createElement("div",{className:"flex items-center space-x-3"},e.default.createElement(s.icon,{className:`h-6 w-6 ${a===r?"text-blue-600":"text-gray-400"}`}),e.default.createElement("div",null,e.default.createElement("div",{className:"font-medium text-gray-900"},s.label),e.default.createElement("div",{className:"text-sm text-gray-500"},s.description))))))),e.default.createElement("div",{className:"bg-gray-50 p-4 rounded-lg"},e.default.createElement("h4",{className:"font-medium text-gray-900 mb-3"},"Export Options"),e.default.createElement("div",{className:"space-y-3"},e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Include item metadata (dates, notes)")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Include category information")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Include purchase history")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Export only low-stock items")))),e.default.createElement("div",{className:"flex justify-center"},e.default.createElement("button",{onClick:le,disabled:n,className:"px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors flex items-center space-x-2"},n?e.default.createElement(e.default.Fragment,null,e.default.createElement(A,{className:"h-5 w-5 animate-spin"}),e.default.createElement("span",null,"Exporting...")):e.default.createElement(e.default.Fragment,null,e.default.createElement(L,{className:"h-5 w-5"}),e.default.createElement("span",null,"Export ",O.export[a].label))))))),ee&&e.default.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},e.default.createElement("div",{className:"bg-white rounded-xl p-6 max-w-6xl w-full mx-4 max-h-[80vh] overflow-y-auto"},e.default.createElement("div",{className:"flex justify-between items-center mb-6"},e.default.createElement("h3",{className:"text-lg font-semibold"},"Preview Import Data"),e.default.createElement("button",{onClick:()=>F(!1),className:"p-1 hover:bg-gray-100 rounded"},e.default.createElement(Q,{className:"h-5 w-5"}))),e.default.createElement("div",{className:"mb-6"},e.default.createElement("h4",{className:"font-medium text-gray-900 mb-3"},"Field Mapping"),e.default.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},["title","qty","category","unit","threshold","notes"].map(r=>e.default.createElement("div",{key:r},e.default.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},r.charAt(0).toUpperCase()+r.slice(1)),e.default.createElement("select",{value:V[r]||"",onChange:s=>q(t=>({...t,[r]:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"},e.default.createElement("option",{value:""},"Not mapped"),E.length>0&&Object.keys(E[0]).map(s=>e.default.createElement("option",{key:s,value:s},s))))))),e.default.createElement("div",{className:"mb-6"},e.default.createElement("h4",{className:"font-medium text-gray-900 mb-3"},"Data Preview (First 10 rows)"),e.default.createElement("div",{className:"overflow-x-auto border border-gray-200 rounded-lg"},e.default.createElement("table",{className:"min-w-full divide-y divide-gray-200"},e.default.createElement("thead",{className:"bg-gray-50"},e.default.createElement("tr",null,E.length>0&&Object.keys(E[0]).map(r=>e.default.createElement("th",{key:r,className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},r)))),e.default.createElement("tbody",{className:"bg-white divide-y divide-gray-200"},E.map((r,s)=>e.default.createElement("tr",{key:s},Object.values(r).map((t,l)=>e.default.createElement("td",{key:l,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},String(t))))))))),e.default.createElement("div",{className:"flex justify-end space-x-3"},e.default.createElement("button",{onClick:()=>F(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e.default.createElement("button",{onClick:ie,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},"Import Data")))))},Ee=pe;export{Ee as default};
