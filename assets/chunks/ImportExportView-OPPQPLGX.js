/*! Personal Inventory Tracker Enhanced */
import{B as _,C as Q,b as de,c as ce,h as B,i as H,j as U,l as T,m as D,n as G,q as K,v as $}from"./chunk-LT2OG7SB.js";var e=de(ce());function Y(v,f){return new Promise((u,o)=>{let b=new FileReader;b.onload=a=>{try{let E=a.target.result.replace(/^\uFEFF/,"").split(`
`).map(l=>l.trim()).filter(l=>l),d=E[0].split(",").map(l=>l.replace(/["']/g,"").trim()),c=E.slice(1).map(l=>{let w=l.split(",").map(p=>p.replace(/["']/g,"").trim()),k={};return d.forEach((p,i)=>{k[p]=w[i]||""}),k}),g={};d.forEach(l=>{let w=l.toLowerCase();Object.entries(f.csv).forEach(([k,p])=>{p.some(i=>w.includes(i))&&(g[k]=l)}),w.startsWith("meta_")&&(g[l]=l)}),u({data:c,mapping:g})}catch(h){o(new Error("Failed to parse CSV file"))}},b.onerror=()=>o(new Error("Failed to read file")),b.readAsText(v)})}function Z(v){return new Promise((f,u)=>{let o=new FileReader;o.onload=b=>{try{let a=JSON.parse(b.target.result);if(!Array.isArray(a)){u(new Error("JSON must contain an array of items"));return}let h={};if(a.length>0){let E=a[0];Object.keys(E).forEach(d=>{let c=d.toLowerCase();c.includes("name")||c.includes("title")?h.title=d:c.includes("qty")||c.includes("quantity")?h.qty=d:c.includes("category")&&(h.category=d)})}f({data:a,mapping:h})}catch(a){u(new Error("Failed to parse JSON file"))}},o.onerror=()=>u(new Error("Failed to read file")),o.readAsText(v)})}function R(){return Promise.reject(new Error("Excel import coming soon! Please use CSV for now."))}function M(v,f,u){let o=new Blob([v],{type:u}),b=URL.createObjectURL(o),a=document.createElement("a");a.href=b,a.download=f,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(b)}var pe=({onItemsUpdated:v})=>{let[f,u]=(0,e.useState)("import"),[o,b]=(0,e.useState)("csv"),[a,h]=(0,e.useState)("csv"),[E,d]=(0,e.useState)(!1),[c,g]=(0,e.useState)(!1),[l,w]=(0,e.useState)(!1),[k,p]=(0,e.useState)(0),[i,J]=(0,e.useState)(null),[S,V]=(0,e.useState)([]),[ee,O]=(0,e.useState)(!1),[P,L]=(0,e.useState)({}),[C,A]=(0,e.useState)({updateExisting:!0,createNew:!0,skipErrors:!0,validateData:!0}),q=(0,e.useRef)(null),W=(0,e.useRef)(null),I={import:{csv:{label:"CSV File",icon:D,accept:".csv",description:"Comma-separated values"},json:{label:"JSON File",icon:T,accept:".json",description:"JavaScript Object Notation"},excel:{label:"Excel File",icon:D,accept:".xlsx,.xls",description:"Microsoft Excel"},api:{label:"API Import",icon:K,accept:"",description:"Import from external API"}},export:{csv:{label:"CSV File",icon:D,description:"Comma-separated values"},json:{label:"JSON File",icon:T,description:"JavaScript Object Notation"},excel:{label:"Excel File",icon:D,description:"Microsoft Excel (coming soon)"},pdf:{label:"PDF Report",icon:G,description:"Printable inventory report"}}},te={csv:{title:["title","name","item_name","product_name"],qty:["qty","quantity","stock","amount"],category:["category","type","group"],unit:["unit","measure","measurement"],threshold:["threshold","min_stock","reorder_level"],notes:["notes","description","memo"],image_url:["image","photo","picture","img"]}};(0,e.useEffect)(()=>{try{let t=localStorage.getItem("pit_field_mapping");t&&L(JSON.parse(t))}catch(t){}},[]),(0,e.useEffect)(()=>{try{localStorage.setItem("pit_field_mapping",JSON.stringify(P))}catch(t){}},[P]);let re=t=>{let r=t.target.files[0];r&&X(r)},se=(0,e.useCallback)(t=>{t.preventDefault(),d(!1);let r=Array.from(t.dataTransfer.files);r.length>0&&X(r[0])},[]),ae=(0,e.useCallback)(t=>{t.preventDefault(),d(!0)},[]),oe=(0,e.useCallback)(t=>{t.preventDefault(),d(!1)},[]),X=async t=>{g(!0),p(10);try{let r;if(o==="csv"?r=await Y(t,te):o==="json"?r=await Z(t):o==="excel"&&(r=await R(t)),p(50),r){let s=JSON.parse(localStorage.getItem("pit_field_mapping")||"{}");L({...r.mapping,...s}),V(r.data.slice(0,10)),O(!0)}p(100)}catch(r){console.error("File processing error:",r),J({success:!1,error:r.message,imported:0,skipped:0,errors:[]})}finally{g(!1)}},ie=async()=>{var t,r;g(!0),p(0);try{let s=S.map(x=>{let j={};return Object.entries(P).forEach(([m,N])=>{N&&x[N]!==void 0&&(j[m]=x[N])}),Object.entries(x).forEach(([m,N])=>{m.startsWith("meta_")&&(j[m]=N)}),j}),n=10,F=0,y=0,z=[];for(let x=0;x<s.length;x+=n){let j=s.slice(x,x+n);try{let m=await fetch(`${(t=window.pitApp)==null?void 0:t.restUrl}items/import`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":(r=window.pitApp)==null?void 0:r.nonce},body:JSON.stringify({items:j,settings:C})});if(m.ok){let N=await m.json();F+=N.imported||0,y+=N.skipped||0}else throw new Error(`HTTP ${m.status}`)}catch(m){if(z.push(`Batch ${Math.floor(x/n)+1}: ${m.message}`),!C.skipErrors)throw m}p(Math.round((x+n)/s.length*100))}J({success:!0,imported:F,skipped:y,errors:z,total:s.length}),v&&v()}catch(s){J({success:!1,error:s.message,imported:0,skipped:0,errors:[]})}finally{g(!1),O(!1)}},le=async()=>{var t,r;w(!0);try{let s=await fetch(`${(t=window.pitApp)==null?void 0:t.restUrl}export?format=${a}`,{headers:{"X-WP-Nonce":(r=window.pitApp)==null?void 0:r.nonce}});if(!s.ok)throw new Error(`Export failed: ${s.status}`);if(a==="json"){let n=await s.json();M(JSON.stringify(n,null,2),`inventory-${new Date().toISOString().split("T")[0]}.json`,"application/json")}else if(a==="csv"){let n=await s.text();M(n,`inventory-${new Date().toISOString().split("T")[0]}.csv`,"text/csv")}else if(a==="pdf"){let n=await s.blob(),F=URL.createObjectURL(n),y=document.createElement("a");y.href=F,y.download=`inventory-report-${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(F)}}catch(s){console.error("Export error:",s),alert("Export failed: "+s.message)}finally{w(!1)}},ne=async()=>{var r;let t=(r=W.current)==null?void 0:r.value;if(!t){alert("Please enter an API URL");return}g(!0);try{let n=await(await fetch(t)).json();if(Array.isArray(n))V(n.slice(0,10)),O(!0);else throw new Error("API must return an array of items")}catch(s){alert("Failed to import from API: "+s.message)}finally{g(!1)}};return e.default.createElement("div",{className:"space-y-6"},e.default.createElement("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},e.default.createElement("h2",{className:"text-xl font-semibold text-gray-900 mb-2"},"Import & Export"),e.default.createElement("p",{className:"text-gray-600"},"Manage your inventory data with bulk import and export operations")),e.default.createElement("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},e.default.createElement("div",{className:"flex border-b border-gray-200"},e.default.createElement("button",{onClick:()=>u("import"),className:`flex-1 px-6 py-4 text-sm font-medium ${f==="import"?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`},e.default.createElement(_,{className:"h-4 w-4 inline mr-2"}),"Import Data"),e.default.createElement("button",{onClick:()=>u("export"),className:`flex-1 px-6 py-4 text-sm font-medium ${f==="export"?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`},e.default.createElement(U,{className:"h-4 w-4 inline mr-2"}),"Export Data")),e.default.createElement("div",{className:"p-6"},f==="import"?e.default.createElement("div",{className:"space-y-6"},e.default.createElement("div",null,e.default.createElement("h3",{className:"font-semibold text-gray-900 mb-3"},"Select Import Format"),e.default.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Object.entries(I.import).map(([t,r])=>e.default.createElement("div",{key:t,onClick:()=>b(t),className:`p-4 border-2 rounded-lg cursor-pointer transition-all ${o===t?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`},e.default.createElement("div",{className:"flex items-center space-x-3"},e.default.createElement(r.icon,{className:`h-6 w-6 ${o===t?"text-blue-600":"text-gray-400"}`}),e.default.createElement("div",null,e.default.createElement("div",{className:"font-medium text-gray-900"},r.label),e.default.createElement("div",{className:"text-sm text-gray-500"},r.description))))))),o==="api"?e.default.createElement("div",{className:"space-y-4"},e.default.createElement("div",null,e.default.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-2"},"API Endpoint URL"),e.default.createElement("div",{className:"flex space-x-3"},e.default.createElement("input",{ref:W,type:"url",placeholder:"https://api.example.com/inventory",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.default.createElement("button",{onClick:ne,disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors"},c?e.default.createElement($,{className:"h-4 w-4 animate-spin"}):"Import")))):e.default.createElement("div",{onDrop:se,onDragOver:ae,onDragLeave:oe,className:`border-2 border-dashed rounded-xl p-8 text-center transition-colors ${E?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"}`},e.default.createElement(_,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.default.createElement("h3",{className:"text-lg font-medium text-gray-900 mb-2"},"Drop your ",I.import[o].label," here"),e.default.createElement("p",{className:"text-gray-500 mb-4"},"Or click to browse files"),e.default.createElement("input",{ref:q,type:"file",accept:I.import[o].accept,onChange:re,className:"hidden"}),e.default.createElement("button",{onClick:()=>{var t;return(t=q.current)==null?void 0:t.click()},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},"Choose File")),e.default.createElement("div",{className:"bg-gray-50 p-4 rounded-lg"},e.default.createElement("h4",{className:"font-medium text-gray-900 mb-3"},"Import Settings"),e.default.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",checked:C.updateExisting,onChange:t=>A(r=>({...r,updateExisting:t.target.checked})),className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Update existing items")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",checked:C.createNew,onChange:t=>A(r=>({...r,createNew:t.target.checked})),className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Create new items")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",checked:C.skipErrors,onChange:t=>A(r=>({...r,skipErrors:t.target.checked})),className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Skip errors and continue")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",checked:C.validateData,onChange:t=>A(r=>({...r,validateData:t.target.checked})),className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Validate data before import")))),c&&e.default.createElement("div",{className:"bg-blue-50 p-4 rounded-lg"},e.default.createElement("div",{className:"flex items-center space-x-3 mb-2"},e.default.createElement($,{className:"h-5 w-5 text-blue-600 animate-spin"}),e.default.createElement("span",{className:"text-blue-800 font-medium"},"Processing import... ",k,"%")),e.default.createElement("div",{className:"w-full bg-blue-200 rounded-full h-2"},e.default.createElement("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${k}%`}}))),i&&e.default.createElement("div",{className:`p-4 rounded-lg ${i.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`},e.default.createElement("div",{className:"flex items-center space-x-3 mb-2"},i.success?e.default.createElement(H,{className:"h-5 w-5 text-green-600"}):e.default.createElement(B,{className:"h-5 w-5 text-red-600"}),e.default.createElement("span",{className:`font-medium ${i.success?"text-green-800":"text-red-800"}`},i.success?"Import Completed":"Import Failed")),i.success?e.default.createElement("div",{className:"text-sm text-green-700"},e.default.createElement("p",null,"Successfully imported ",i.imported," items"),i.skipped>0&&e.default.createElement("p",null,"Skipped ",i.skipped," items"),i.errors.length>0&&e.default.createElement("details",{className:"mt-2"},e.default.createElement("summary",{className:"cursor-pointer"},"View errors (",i.errors.length,")"),e.default.createElement("ul",{className:"mt-1 ml-4 list-disc"},i.errors.map((t,r)=>e.default.createElement("li",{key:r},t))))):e.default.createElement("div",{className:"text-sm text-red-700"},i.error))):e.default.createElement("div",{className:"space-y-6"},e.default.createElement("div",null,e.default.createElement("h3",{className:"font-semibold text-gray-900 mb-3"},"Select Export Format"),e.default.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Object.entries(I.export).map(([t,r])=>e.default.createElement("div",{key:t,onClick:()=>h(t),className:`p-4 border-2 rounded-lg cursor-pointer transition-all ${a===t?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"} ${t==="excel"?"opacity-50 cursor-not-allowed":""}`},e.default.createElement("div",{className:"flex items-center space-x-3"},e.default.createElement(r.icon,{className:`h-6 w-6 ${a===t?"text-blue-600":"text-gray-400"}`}),e.default.createElement("div",null,e.default.createElement("div",{className:"font-medium text-gray-900"},r.label),e.default.createElement("div",{className:"text-sm text-gray-500"},r.description))))))),e.default.createElement("div",{className:"bg-gray-50 p-4 rounded-lg"},e.default.createElement("h4",{className:"font-medium text-gray-900 mb-3"},"Export Options"),e.default.createElement("div",{className:"space-y-3"},e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Include item metadata (dates, notes)")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",defaultChecked:!0,className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Include category information")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Include purchase history")),e.default.createElement("label",{className:"flex items-center space-x-3"},e.default.createElement("input",{type:"checkbox",className:"rounded border-gray-300"}),e.default.createElement("span",{className:"text-sm"},"Export only low-stock items")))),e.default.createElement("div",{className:"flex justify-center"},e.default.createElement("button",{onClick:le,disabled:l,className:"px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors flex items-center space-x-2"},l?e.default.createElement(e.default.Fragment,null,e.default.createElement($,{className:"h-5 w-5 animate-spin"}),e.default.createElement("span",null,"Exporting...")):e.default.createElement(e.default.Fragment,null,e.default.createElement(U,{className:"h-5 w-5"}),e.default.createElement("span",null,"Export ",I.export[a].label))))))),ee&&e.default.createElement("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},e.default.createElement("div",{className:"bg-white rounded-xl p-6 max-w-6xl w-full mx-4 max-h-[80vh] overflow-y-auto"},e.default.createElement("div",{className:"flex justify-between items-center mb-6"},e.default.createElement("h3",{className:"text-lg font-semibold"},"Preview Import Data"),e.default.createElement("button",{onClick:()=>O(!1),className:"p-1 hover:bg-gray-100 rounded"},e.default.createElement(Q,{className:"h-5 w-5"}))),e.default.createElement("div",{className:"mb-6"},e.default.createElement("h4",{className:"font-medium text-gray-900 mb-3"},"Field Mapping"),e.default.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},["title","qty","category","unit","threshold","notes","image_url"].map(t=>e.default.createElement("div",{key:t},e.default.createElement("label",{className:"block text-sm font-medium text-gray-700 mb-1"},t.charAt(0).toUpperCase()+t.slice(1)),e.default.createElement("select",{value:P[t]||"",onChange:r=>L(s=>({...s,[t]:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"},e.default.createElement("option",{value:""},"Not mapped"),S.length>0&&Object.keys(S[0]).map(r=>e.default.createElement("option",{key:r,value:r},r))))))),e.default.createElement("div",{className:"mb-6"},e.default.createElement("h4",{className:"font-medium text-gray-900 mb-3"},"Data Preview (First 10 rows)"),e.default.createElement("div",{className:"overflow-x-auto border border-gray-200 rounded-lg"},e.default.createElement("table",{className:"min-w-full divide-y divide-gray-200"},e.default.createElement("thead",{className:"bg-gray-50"},e.default.createElement("tr",null,S.length>0&&Object.keys(S[0]).map(t=>e.default.createElement("th",{key:t,className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},t)))),e.default.createElement("tbody",{className:"bg-white divide-y divide-gray-200"},S.map((t,r)=>e.default.createElement("tr",{key:r},Object.values(t).map((s,n)=>e.default.createElement("td",{key:n,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},String(s))))))))),e.default.createElement("div",{className:"flex justify-end space-x-3"},e.default.createElement("button",{onClick:()=>O(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"},"Cancel"),e.default.createElement("button",{onClick:ie,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},"Import Data")))))},Ee=pe;export{Ee as default};
